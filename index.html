<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Hello!</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Entire bundle -->
    <script src="https://cdn.jsdelivr.net/npm/@shopify/draggable@1.0.0-beta.8/lib/draggable.bundle.js"></script>
    
    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="/style.css">
    <script>
      window.commandSet = [];
      function init(){
        var paper = document.getElementById('paper');
        window.paper = paper;
        function dispatchPageValueChange(dispatchObject){
          var event = new CustomEvent('pageValueChanged', dispatchObject);
          paper.dispatchEvent(event);
        }
        function dispatchStoryChange(dispatchObject){
          var event = new CustomEvent('storiesChanged', dispatchObject);
          paper.dispatchEvent(event);
        }
        function dispatchBudgetChange(dispatchObject){
          var event = new CustomEvent('budgetChanged', dispatchObject);
          paper.dispatchEvent(event);
        }
        function dispatchDistributionChange(dispatchObject){
          var event = new CustomEvent('distributionChanged', dispatchObject);
          paper.dispatchEvent(event);
        }
        function dispatchAdValueChange(dispatchObject){
          var event = new CustomEvent('adValueChanged', dispatchObject);
          paper.dispatchEvent(event);
        }
        function dispatchAdCountChange(dispatchObject){
          var event = new CustomEvent('adCountChanged', dispatchObject);
          paper.dispatchEvent(event);
        }
        window.budgetManager = {
          pageCount: 1,
          totalBudget: -1000,
          totalAdSales: 0,
          stories: 0,
          distribution: 1000,
          valueOfAdSquare: 50,
          pageDistributionFactor: 500,
          storyDistributionFactor: 750,
          wordcount: 0,
          adCount: 0,
          pages: [
                  { wordcount: 0 } 
                 ],
          getPages: function() { 
            return this.pageCount;
          },
          setPages: function(x) {
            this.pageCount = x;
            this.totalBudget = x*-1000;
            dispatchPageValueChange({detail: this.pageCount});
            dispatchBudgetChange({detail: this.totalBudget});
          },
          addPages: function(x) {
            this.pageCount += x;
            this.totalBudget += x*-1000;
            dispatchPageValueChange({detail: this.pageCount});
            dispatchBudgetChange({detail: this.totalBudget});
            this.pages.push( { wordcount: 0 } );
            if (this.pageCount % 10 === 0){
              this.pageDistributionFactor = 500 * (this.pageCount/10);
            }
            this.addDistribution(this.pageDistributionFactor);
          },
          subtractPages: function(x) {
            this.pageCount -= x;
            this.totalBudget -= x*-1000;
            dispatchPageValueChange({detail: this.pageCount});
            dispatchBudgetChange({detail: this.totalBudget});
            this.pages.pop( { wordcount: 0 } );
          },
          
          getBudget: function(){
            return this.totalBudget;
          },
          
          getValueOfAd: function() { 
            return this.valueOfAdSquare;
          },
          setValueOfAd: function(x) {
            this.valueOfAdSquare = x;
            dispatchAdValueChange({detail: this.valueOfAdSquare});
          },
          addValueOfAd: function(x) {
            this.valueOfAdSquare += x;
            dispatchAdValueChange({detail: this.valueOfAdSquare});
          },
          subtractValueOfAd: function(x) {
            this.valueOfAdSquare -= x;
            dispatchAdValueChange({detail: this.valueOfAdSquare});
          },
          
          getAdCount: function() { 
            return this.adCount;
          },
          addAdCount: function(x) {
            this.adCount += x;
            this.totalBudget += (x) * this.valueOfAdSquare;
            dispatchBudgetChange({detail: this.totalBudget});
            dispatchAdCountChange({detail: this.adCount});
          },
          subtractAdCount: function(x) {
            this.adCount -= x;
            this.totalBudget -= (x) * this.valueOfAdSquare;
            dispatchBudgetChange({detail: this.totalBudget});
            dispatchAdCountChange({detail: this.adCount});
          },
          
          getTotalWordCount: function() { 
            return this.wordcount;
          },
          addWordcount: function(x) {
            this.wordcount += x;
            if ((this.wordcount % 1375) == 0){
              this.storyDistributionFactor = this.storyDistributionFactor * (this.wordcount/1375);
              this.addDistribution(this.storyDistributionFactor);
            }
          },
          
          getDistribution: function() { 
            return this.distribution;
          },
          addDistribution: function(x) {
            this.distribution += x;
            this.addValueOfAd(50*((x/1000)+1));
            this.totalBudget += (x)*-1;
            dispatchDistributionChange({detail: this.distribution});
            dispatchBudgetChange({detail: this.totalBudget});
          },
          subtractDistribution: function(x) {
            this.distribution -= x;
            this.subtractValueOfAd(50*(x/1000));
            this.totalBudget -= (x)*-1;
            dispatchDistributionChange({detail: this.distribution});
            dispatchBudgetChange({detail: this.totalBudget});
          },
          
          getStories: function() { 
            return this.stories;
          },
          setStories: function(x) {
            this.stories = x;
            this.totalBudget += x*-300;
            dispatchStoryChange({detail: this.stories});
            dispatchBudgetChange({detail: this.totalBudget});
          },
          addStories: function(x) {
            this.stories += x;
            this.totalBudget += x*-300;
            dispatchStoryChange({detail: this.stories});
            dispatchBudgetChange({detail: this.totalBudget});
          },
          subtractStories: function(x) {
            this.pageCount -= x;
            this.totalBudget -= x*-300;
            dispatchStoryChange({detail: this.stories});
            dispatchBudgetChange({detail: this.totalBudget});
          },
        };
        console.log('Current Page Count: ', budgetManager.pageCount);
      
        paper.addEventListener('pageValueChanged', function(returnedObject){
          console.log('Current Page Count: ', returnedObject.detail);
        }, false);
        
        paper.addEventListener('storiesChanged', function(returnedObject){
          console.log('Current Story Count: ', returnedObject.detail);
        }, false);
        
        window.commandSet.forEach(function(callback){ callback();  });
        window.commandSet = {
          push: function(callback){
            callback();
          }
        };
      }
        if (
            document.readyState === "complete" ||
            (document.readyState !== "loading" && !document.documentElement.doScroll)
        ) {
          init();
        } else {
          document.addEventListener("DOMContentLoaded", init);
        }
    </script>
    
  </head>  
  <body>
    <h1>Newspaper Business Simulator</h1>
    <h4>
      Newspaper Budget: $<span id="total-budget">-1000</span> | Newspaper Distribution: <span id="total-distribution">1000</span>
    </h4>
    <div id="toolbox">
      <h5>
        Toolbox: </h5>
      <button class="shinyButton shinyBlue" onclick="pageAdd()">Add Page</button>
      <button class="shinyButton shinyLime" onclick="addStoryToToolbox()">Commission Story</button>
      <button class="shinyButton shinyPurple" onclick="pageAdd()">Sell Ad</button>
    </div>
    <div id="paper">
      <div id="page-1" class="stacked newspaper__page page-grid">

      </div>
    </div>
    <!-- include the Glitch button to show what the webpage is about and
          to make it easier for folks to view source and remix -->
    <div class="glitchButton" style="position:fixed;top:20px;right:20px;"></div>
    <script src="https://button.glitch.me/button.js"></script>
    <script src="/holder-ipsum.js" defer></script>
        <!-- import the webpage's javascript file -->
    <script src="/script.js" defer></script>
    
    <script>
      
    </script>
  </body>
</html>
